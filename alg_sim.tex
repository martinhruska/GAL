\KwIn{NTA $A=(Q,\Sigma, \delta, F)$}
	\KwOut{$\preceq \subseteq Q \times Q$}
	\SetKwFunction{main}{main}
	\SetKwProg{main}{}{}{}

	\ForEach{$q\in Q$} {
		\ForEach{$a\in \Sigma$} {
			$\delta^r(q,a) = \{k \in Q\,|\, a(q_1,\ldots, q_i, \ldots, q_n) \rightarrow k \emph{ where } i \in \{1..n\}, q = q_i \}$\;
			$card(q,a) = |\{a(q_1, \ldots, q_n) \rightarrow q \in \delta\}|$\;
		}
	}

	initialize all $N(a)$s with $0$s\;
	$sim := Q\times Q$\;
	$C := \emptyset$\;

	\ForEach{$p \in F$} {
		\ForEach{$q \in Q \setminus F$} {
			$sim = sim \setminus \{(p,q)\}$\;
			$C = C \cup \{(p,q)\}$\;
		}
	}
	
	\While{$C \neq \emptyset$}
	{
		Take $(p,q)$ from $C$\;
		\ForEach{$a \in \Sigma$}
		{
			\ForEach{$k \in \delta^r(q,a)$}
			{
				\If {$(a(q_1,\ldots, q_i, \ldots, q_n) \rightarrow k) \in \delta \wedge
					(a(p_1, \ldots, p_i, \ldots, p_n) \rightarrow p') \in \delta, \emph{ where } i\in \{1..n\},\ q_i = q,\ p_i = p $}
				{
					$N_{kp}(a) = N_{kp}(a) + 1$\;
				}

				\If{$N_{kp}(a) = card(k,a)$}
				{
					\ForEach{$l \in \delta^r(p,a)$}
					{
						\If{$(l,k) \in sim$}
						{
							$sim = sim \setminus {(l,k)}$\;
							$C = C \cup {(l,k)}$\;
						}
					}
				}
			}
		}

	}
	\Return $sim$\;
